---
title: 'Проблемы с потерей данных на Ext4 разделах в тестовой версии Ubuntu 9.04'
date: '2009-03-13T13:29:53+03:00'
uri: 'news/problemy-s-poterei-dannyh-na-ext4'
alias: 
  - 'news/62.html'
tags: '9.04,Ubuntu Linux,Ext4,баг'
source: 'http://www.opennet.ru/opennews/art.shtml?num=20715'
unixtime: 1236940193
visits: 1438
---
При тестировании экспериментальной версии Ubuntu 9.04 [всплыли](http://bugs.edge.launchpad.net/ubuntu/+source/linux/+bug/317781) неожиданные проблемы с надежностью работы Ext4. В Ubuntu по умолчанию включена возможность отложенного распределения информации в ext4 (Delayed allocation), при которой данные и мета-данные могут оставаться не записанными до 60 секунд.

Данная возможность является одним из главных факторов значительного повышения производительности ext4 по сравнению с ext3. Но пользователи экспериментальной ветки Ubuntu отметили случаи произвольного краха системы, после которого терялось содержимое большого числа файлов, в основном связанных с работой KDE или GNOME. Разбор ситуации показал, что при загрузке KDE и GMOME пересоздают большое число мелких файлов, и если системный крах произойдет через небольшое после загрузки время, эти файлы окажутся обнуленными (в журнал изменения вносятся сразу, но сами данные на диск записаться не успевают), а десктоп-окружения неработоспособными из-за потери файлов конфигурации.

Подобные проблемы с потерей пересоздаваемых перед крахом файлов также свойственны таким файловым системам как XFS и Btrfs. Ted Ts'o, разработчик ext4, [считает](http://bugs.edge.launchpad.net/ubuntu/+source/linux/+bug/317781/comments/45), что отчасти в проблеме виноваты авторы программ, целиком перезаписывающих без необходимости содержимое файлов конфигурации, полагаясь на особенности работы ext3 в стандартном режиме журналирования “data=ordered”, при котором вначале изменяются данные, а потом изменения отражаются в журнале. Тем не менее Ted пообещал выпустить патч, изменяющий поведение отложенной записи в ext4 при фиксировании фактов обнуления или переименования файлов. Патч не успеет войти в состав ядра 2.6.29, но намечен для включения в ядро 2.6.30.
